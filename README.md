# YoruPlayer 功能文档

## 项目简介
YoruPlayer 是一个**前后端分离的 Web 音乐播放器**，核心功能包括：
- 🎵 用户管理、资源管理、播放控制
- 📦 基于 MinIO 实现音频/图片对象存储
- 🔄 HTTP 通信协议保证前后端交互稳定性
- 🚀 高性能推荐算法与实时数据同步

---

## 技术架构

### 前端技术栈
| 类别       | 技术选型                | 核心功能                          |
|------------|-------------------------|----------------------------------|
| 框架       | Next.js (React)         | 服务端渲染 & 路由管理            |
| UI 组件库  | MDUI + Tailwind CSS     | 原子化样式 & 响应式布局          |
| 状态管理   | 状态提升 + 自定义 Emitter | 跨组件通信 & 播放器全局状态控制  |
| 网络请求   | 自封装 Fetch 工具       | Token 自动注入 & 请求拦截        |

### 后端技术栈
| 类别          | 技术选型                | 核心功能                          |
|---------------|-------------------------|----------------------------------|
| Web 框架      | Hertz (Go)             | 高性能 HTTP 服务                 |
| 数据库        | MySQL + GORM           | 关系型数据持久化                 |
| 缓存/消息队列 | Redis + Kafka          | 高频接口优化 & 异步任务处理      |
| 对象存储      | MinIO                  | 音频/图片文件存储管理            |
| 推荐算法服务  | C++ Eigen + Crow       | 矩阵计算 & SVD 分解推荐模型      |

---

# 核心功能模块


## 用户模块

- 登录&注册

在单独页面内进行，登录和注册成功后后端返回token，前端将其存入localstroge，在封装的fetch方法中获取token并将其放入请求头以进行权限控制。后端封装jwt中间件进行鉴权。

- 修改信息&上传头像
  登录后从主页侧面导航的标签或顶部搜索栏的用户头像中进入用户主页，主页显示用户所有信息以及创建的歌单。在页面可以进行歌单的管理，填写表单更新用户信息，上传头像及时更新。

## 资源上传


- 新增或编辑单曲|专辑|作者
  单曲和专辑分别拥有一个管理页面。从主页左侧导航栏进入后默认为新增模式，新增模式下展示信息表单由用户填写，通过按钮交互将包括图片和媒体文件在内的数据通过formdata形式传递调用后端上传接口。通过表单顶部的输入框进行搜索，使用了绝对定位和防抖函数每秒根据输入框内容从后端获取搜索结果并展示在其底部的一个框内，通过点击框内的结果将表单数据替换为对应单曲|专辑的数据，原本的创建流程变为更新流程，其作者以前者相同方式支持自动搜索填入表单，如果没有找到作者则可通过`未找到现有的作者`字样唤出创建作者弹窗，以大致相同的布局和功能模式进行作者的新增的修改。

## 播放控制

- 播放以及其列表控制
  播放器表现为一个底部栏和侧栏的播放队列,底部有个播放进度条实时同步和控制播放进程,以及控制暂停和切换歌曲等按钮,提供隐藏功能以及打开和关闭播放队列功能。在搜索和歌单以及队列中的歌曲列表的每一项均提供不同策略的加入播放队列的功能,例如下一首播放和切换播放等。后端以用户uid为主键的一部分,每次队列状态变化时前端通过http请求同步播放队列,并存储在redis中。

## 数据展示

- 不同种类歌曲列表展示策略
  使用不同状态控制歌曲列表的展示状态,例如展示作者时展示其热门歌曲以及其专辑,展示专辑时显示专辑内所有歌曲以及描述,根据其封面图片自动变换背景颜色等等
- 快捷跳转
  复用的列表数据展示组件提供随时随地跳转到其作者或所属专辑的详情页面,随时随地进行跳转或刷新当前的歌曲列表页面
- 全部搜索
  顶部搜索栏提供的搜索结果包括了单曲的分页搜索,相关的专辑搜索以及由用户创建的歌单的搜索,采用美观有条理的页面综合展示数据并提供跳转到详情页面的功能
  
##数据分析
- 计算推荐标签和作者
通过redis缓存用户的历史播放数据，将最近若干的历史播放的歌曲以及他们的标签保存，在进行获取推荐歌曲逻辑时，将这些数据通过Http调用的方式传递给cpp服务,cpp服务将历史记录构造为歌曲-标签矩阵，考虑共现，频率，两个方面进行SVD分解和置信度计算，以此获取返回的推荐标签和作者进行下一步数据库相关查询逻辑并最终返回用户偏好的歌曲

